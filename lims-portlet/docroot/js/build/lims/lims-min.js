YUI.add("lims-core",function(e,t){if(!e.one("#lims-container .lims-bar"))return;e.namespace("LIMS.Core"),e.LIMS.Core.DateFormatter=e.Base.create("dateFormatter",e.Base,[],{prettyDate:function(e){var t=this.get("localizedRanges"),n=new Date(e||""),r,i;return r=((new Date).getTime()-n.getTime())/1e3,i=Math.floor(r/86400),i<0?t.justNow:isNaN(i)?"":i===0?this._lessThanDay(r):i===1?this._yesterday():i<7?this._lastThanWeek(i):i<=31?this._lessThanMonth(i):this.formatDate(n)},_lessThanDay:function(t){var n=this.get("localizedRanges");return t<60?n.justNow:t<120?n.minuteAgo:t<3600?e.Lang.sub(n.minutesAgo,{x:Math.floor(t/60)}):t<7200?n.hourAgo:e.Lang.sub(n.hoursAgo,{x:Math.floor(t/3600)})},_yesterday:function(){var e=this.get("localizedRanges");return e.yesterday},_lastThanWeek:function(t){var n=this.get("localizedRanges");return e.Lang.sub(n.daysAgo,{x:t})},_lessThanMonth:function(t){var n=this.get("localizedRanges");return e.Lang.sub(n.weeksAgo,{x:Math.ceil(t/7)})},formatDate:function(t){var n=this.get("dateFormat");return e.Lang.sub(n,{day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear(),hours:t.getHours(),minutes:(t.getMinutes()<10?"0":"")+t.getMinutes().toString()})}},{ATTRS:{localizedRanges:{valueFn:function(){return{justNow:e.LIMS.Core.i18n.values.timeRangeJustNow,minuteAgo:e.LIMS.Core.i18n.values.timeRangeMinuteAgo,minutesAgo:e.LIMS.Core.i18n.values.timeRangeMinutesAgo,hourAgo:e.LIMS.Core.i18n.values.timeRangeHourAgo,hoursAgo:e.LIMS.Core.i18n.values.timeRangeHoursAgo,yesterday:e.LIMS.Core.i18n.values.timeRangeYesterday,daysAgo:e.LIMS.Core.i18n.values.timeRangeDaysAgo,weeksAgo:e.LIMS.Core.i18n.values.timeRangeWeeksAgo}}},dateFormat:{valueFn:function(){return e.LIMS.Core.i18n.values.dateFormat}}}}),e.namespace("LIMS.Core"),e.LIMS.Core.i18n=e.Base.create("i18n",e.Base,[],{values:null}),e.namespace("LIMS.Core"),e.LIMS.Core.ViewController=e.Base.create("viewController",e.View,[],{setup:function(t,n){this.set("container",t),this.set("controllerId",n),this.set("panel",new e.LIMS.View.PanelView({container:t,panelId:n})),this.onPanelDidLoad(),e.on("panelShown",this._onPanelShown,this),e.on("panelHidden",this._onPanelHidden,this),e.on("panelClosed",this._onPanelClosed,this),e.on("chatEnabled",this._onChatEnabled,this),e.on("chatDisabled",this._onChatDisabled,this),e.on("userSessionExpired",this._onSessionExpired,this),this.get("panel").get("isOpened")===!0&&this.onPanelDidAppear()},onPanelDidLoad:function(){},onPanelDidAppear:function(){},onPanelDidDisappear:function(){},onPanelDidUnload:function(){},onSessionExpired:function(){},showViewController:function(){e.LIMS.Core.Util.show(this.get("container"))},hideViewController:function(){e.LIMS.Core.Util.hide(this.get("container"))},presentViewController:function(){this.get("panel").show()},dismissViewController:function(){this.get("panel").hide()},getPanel:function(){return this.get("panel")},getControllerId:function(){return this.get("controllerId")},getContainer:function(){return this.get("container")},showError:function(e){var t=this.get("panel");t.showError(e)},hideError:function(){var e=this.get("panel");e.hideError()},_onPanelShown:function(e){e===this.get("panel")?(this.onPanelDidAppear(),this.fire("panelDidAppear",this)):this.get("panel").get("isOpened")===!0&&(this.dismissViewController(),this.fire("panelDidDisappear",this))},_onPanelHidden:function(e){e===this.get("panel")&&(this.onPanelDidDisappear(),this.fire("panelDidAppear",this))},_onPanelClosed:function(e){e===this.get("panel")&&(this.onPanelDidUnload(),this.fire("panelDidUnload",{controllerId:this.get("controllerId")}))},_onChatEnabled:function(){this.showViewController()},_onChatDisabled:function(){this.hideViewController()},_onSessionExpired:function(){this.onSessionExpired(),this.hideViewController()}},{ATTRS:{controllerId:{value:null},container:{value:null},panel:{value:null}}}),e.namespace("LIMS.Core"),e.LIMS.Core.Notification=e.Base.create("notification",e.View,[],{audioSoundTemplate:e.one("#lims-notification-audio-template").get("innerHTML"),embedSoundTemplate:e.one("#lims-notification-embed-template").get("innerHTML"),mp3SoundFile:"/lims-portlet/audio/notification.mp3",wavSoundFile:"/lims-portlet/audio/notification.wav",initializer:function(){this._attachEvents()},notify:function(e){var t=this.get("settings");e&&(this.set("lastMessage",e),t.isMute()||(this._playSound(),this._showNotification()),this._updatePageTitleMessage())},suppress:function(){var t=this.get("timer");clearTimeout(t),e.config.doc.title=this.get("defaultPageTitle")},_attachEvents:function(){e.one(e.config.win).on("focus",this._onWindowFocus,this),e.one(e.config.win).on("blur",this._onWindowBlur,this)},_showNotification:function(){var e,t=this.get("lastMessage");e=function(){var e,n,r;n=t.get("from").printableName(),r=t.get("body"),r.length>80&&(r=r.substring(0,75)+"..."),e=new Notification(n,{body:r})};if(!("Notification"in window))return;if(Notification.permission==="denied")return;if(Notification.permission==="granted"){e();return}Notification.requestPermission(function(t){t==="granted"&&e()})},_playSound:function(){var e=this.get("container"),t=this.get("audioSoundPlayer"),n=this.get("embedSoundPlayer");this._canPlayAudio()?(t.inDoc()||e.append(t),t.getDOM().play()):(n.inDoc()&&n.remove(),e.set("innerHTML",n.get("innerHTML")))},_canPlayAudio:function(){var e=document.createElement("audio"),t,n,r;return t=!!e.canPlayType,n=t&&!!e.canPlayType('audio/wav; codecs="1"').replace(/no/,""),r=t&&!!e.canPlayType("audio/mpeg;").replace(/no/,""),t&&(n||r)},_updatePageTitleMessage:function(){var t=this.get("defaultPageTitle"),n=this.get("lastMessage"),r=this.get("timerInterval"),i=this.get("timer"),s=this.get("windowHasFocus"),o=this.get("properties");o.isChatEnabled()?!s&&n&&(clearTimeout(i),this.set("timer",setInterval(function(){var r=e.config.doc.title,i=e.Lang.sub(e.LIMS.Core.i18n.values.incomingMessageTitleText,{fullName:n.get("from").printableName()});e.config.doc.title=r===t?i:t},r))):e.config.doc.title=t},_onWindowFocus
:function(){this.set("windowHasFocus",!0),this.suppress()},_onWindowBlur:function(){this.set("windowHasFocus",!1)}},{ATTRS:{container:{value:null},settings:{value:null},properties:{value:null},audioSoundPlayer:{valueFn:function(){return e.Node.create(e.Lang.sub(this.audioSoundTemplate,{wav:this.wavSoundFile,mp3:this.mp3SoundFile}))}},embedSoundPlayer:{valueFn:function(){return e.Node.create(e.Lang.sub(this.embedSoundTemplate,{wav:this.wavSoundFile}))}},lastMessage:{value:null},defaultPageTitle:{valueFn:function(){return e.config.doc.title}},windowHasFocus:{value:!0},timer:{value:null},timerInterval:{value:2e3}}}),e.namespace("LIMS.Core"),e.LIMS.Core.Properties=e.Base.create("properties",e.Base,[],{userId:null,companyId:null,pathImage:null,isIE:!1,resourceURL:null,values:null,initializer:function(){this._attachEvents()},getCurrentUserId:function(){return this.get("userId")},getCurrentUserCompanyId:function(){return this.get("companyId")},getCurrentUserMale:function(){return this.get("male")},getCurrentUserPortraitId:function(){return this.get("portraitId")},getCurrentUserPortraitImageToken:function(){return this.get("portraitImageToken")},getCurrentUserPortraitToken:function(){return this.get("portraitToken")},getCurrentUserScreenName:function(){return this.get("screenName")},getCurrentUserFullName:function(){return this.get("fullName")},getServerTimeOffset:function(){return this.get("offset")},isChatEnabled:function(){return this.get("isChatEnabled")},_attachEvents:function(){e.on("chatEnabled",this._onChatEnabled,this),e.on("chatDisabled",this._onChatDisabled,this)},_onChatEnabled:function(){this.set("isChatEnabled",!0)},_onChatDisabled:function(){this.set("isChatEnabled",!1)}},{ATTRS:{userId:{valueFn:function(){return e.LIMS.Core.Properties.values.userId}},companyId:{valueFn:function(){return e.LIMS.Core.Properties.values.companyId}},male:{valueFn:function(){return e.LIMS.Core.Properties.values.male}},portraitId:{valueFn:function(){return e.LIMS.Core.Properties.values.portraitId}},portraitImageToken:{valueFn:function(){return e.LIMS.Core.Properties.values.portraitImageToken}},portraitToken:{valueFn:function(){return e.LIMS.Core.Properties.values.portraitToken}},screenName:{valueFn:function(){return e.LIMS.Core.Properties.values.screenName}},fullName:{valueFn:function(){return e.LIMS.Core.Properties.values.fullName}},serverTime:{valueFn:function(){return e.LIMS.Core.Properties.values.currentServerTime}},offset:{valueFn:function(){var e=this.get("serverTime");return(new Date).getTime()-e}},pathImage:{valueFn:function(){return e.LIMS.Core.Properties.pathImage}},isChatEnabled:{valueFn:function(){return e.LIMS.Core.Properties.values.portletEnabled}}}}),e.namespace("LIMS.Core"),e.LIMS.Core.Poller=e.Base.create("poller",e.Base,[],{register:function(e,t){var n=this.get("entries");n.hasOwnProperty(e)&&n[e].stopPolling(),n[e]=t,t.startPolling()},unregister:function(e){var t=this.get("entries");t.hasOwnProperty(e)&&(t[e].stopPolling(),delete t[e])}},{ATTRS:{entries:{value:{}}}}),e.namespace("LIMS.Core"),e.LIMS.Core.PollerEntry=e.Base.create("pollerEntry",e.Base,[],{startPolling:function(){var e=this.get("interval"),t=this;this._loadModel(),this.set("timer",setInterval(function(){t._loadModel()},e))},stopPolling:function(){var e=this.get("timer");clearTimeout(e)},_loadModel:function(){var t=this.get("model"),n=this.get("connectionMonitor"),r=this.get("requestInQueue"),i=this;if(r)return;this.set("requestInQueue",!0),t.load(function(t){i.set("requestInQueue",!1),n&&(t?e.fire("connectionError"):e.fire("connectionOK"))})}},{ATTRS:{model:{value:null},interval:{value:null},connectionMonitor:{value:!1},timer:{value:null},requestInQueue:{value:!1}}}),e.namespace("LIMS.Core");var n={htmlDecode:function(t){var n=e.Node.create("<div/>");return n.set("innerHTML",t),n.get("innerHTML")},firstCharacter:function(t){var n=this.htmlDecode(e.Lang.trim(t));return n&&n.length>0?n.charAt(0):""},isHidden:function(e){return e.hasClass("hide")},show:function(e){e.removeClass("hide")},hide:function(e){e.addClass("hide")},linkify:function(e){var t=/\b(?:https?|ftp):&#x2F;&#x2F;[a-z0-9-+&@#&#x2F;%?=~_|!:,.;]*[a-z0-9-+&@#&#x2F;%=~_|]/gim,n=/[\w.]+@[a-zA-Z_\-]+?(?:\.[a-zA-Z]{2,6})+/gim;return e.replace(t,'<a class="link" target="_blank" href="$&">$&</a>').replace(n,'<a class="link" target="_blank" href="mailto:$&">$&</a>')}};e.LIMS.Core.Util=n},"@VERSION@",{requires:["view","base","node"]}),YUI.add("lims-model",function(e,t){if(!e.one("#lims-container .lims-bar"))return;e.namespace("LIMS.Model"),e.LIMS.Model.ModelExtension=function(){},e.LIMS.Model.ModelExtension.prototype={getServerRequestUrl:function(){return e.LIMS.Core.Properties.resourceURL}},e.namespace("LIMS.Model"),e.LIMS.Model.BuddyModelItem=e.Base.create("buddyModelItem",e.Model,[e.LIMS.Model.ModelExtension],{updatePresence:function(t,n){var r;this.set("presence",t),r=e.JSON.stringify(this.toJSON()),e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"UpdateBuddyPresence",content:r},on:{success:function(e,t){n&&n(null,t.responseText)},failure:function(t,r){r.status===401&&e.fire("userSessionExpired"),n&&n("Cannot update buddy presence",r.responseText)}}})},printableName:function(){var t=this.get("fullName"),n=this.get("screenName");return t&&t.length>0?t:n&&n.length>0?n:e.LIMS.Core.i18n.values.unknownUserPlaceholder}},{ATTRS:{buddyId:{value:null},screenName:{value:""},male:{value:null},portraitId:{value:0},portraitToken:{value:null},portraitImageToken:{value:null},fullName:{value:""},presence:{value:null}}}),e.namespace("LIMS.Model"),e.LIMS.Model.BuddyModelList=e.Base.create("buddyModelList",e.ModelList,[],{model:e.LIMS.Model.BuddyModelItem},{}),e.namespace("LIMS.Model"),e.LIMS.Model.BuddySearchListModel=e.Base.create("buddySearchListModel",e.ModelList,[e.LIMS.Model.ModelExtension],{model:e.LIMS.Model.BuddyModelItem,search:function(e){this.set("searchQuery",e),this.load()},sync:function(t,n,r){var i,s=this,o=this.get("searchQuery");switch(t){case"read":this.fire
("searchStarted"),i=e.JSON.stringify({searchQuery:o}),e.io(this.getServerRequestUrl(),{method:"GET",data:{query:"SearchBuddies",parameters:i},on:{success:function(t,n){var r,i;r=e.JSON.parse(n.responseText),s.reset();for(i=0;i<r.length;i++)s.add(new e.LIMS.Model.BuddyModelItem(r[i]));s.fire("searchSuccess",{searchList:s})},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),s.reset(),s.fire("searchError"),r&&r("search error",n.responseText)}}});break;case"create":case"update":case"delete":return;default:r("Invalid action")}}},{ATTRS:{searchQuery:{value:null}}}),e.namespace("LIMS.Model"),e.LIMS.Model.ConversationModel=e.Base.create("conversationModel",e.Model,[e.LIMS.Model.ModelExtension],{addMessage:function(e){var t=this.get("messageList"),n=this.get("serverTimeOffset"),r,i=this;e.set("conversationId",this.get("conversationId")),e.save(function(e){e&&i.fire("messageError")}),r=e.get("createdAt"),e.set("createdAt",r+n),t.add(e),this.fire("messageAdded",{message:e})},closeConversation:function(){var t=e.JSON.stringify({conversationId:this.get("conversationId")});e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"CloseSingleUserConversation",parameters:t},on:{failure:function(t,n){n.status===401&&e.fire("userSessionExpired")}}})},resetUnreadMessagesCounter:function(t){var n=this,r=e.JSON.stringify({conversationId:this.get("conversationId")});e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"ResetUnreadMessagesCounter",parameters:r},on:{success:function(){n.set("unreadMessagesCount",0),t&&t(null,n)},failure:function(r,i){i.status===401&&e.fire("userSessionExpired"),t&&t("cannot reset unread messages",n)}}})},sync:function(t,n,r){var i,s,o=this,u,a=this.get("etag");switch(t){case"create":o.fire("createBegin"),i=e.JSON.stringify(this.toJSON()),e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"CreateSingleUserConversation",content:i},on:{success:function(t,n){u=e.JSON.parse(n.responseText),o.fire("createSuccess"),r(null,o)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),o.fire("createError"),r("Cannot create new conversation",n)}}});return;case"read":o.fire("readBegin"),s=e.JSON.stringify({conversationId:this.get("conversationId"),etag:a,pagination:{firstMessageId:null,lastMessageId:null,action:"next"}}),e.io(this.getServerRequestUrl(),{method:"GET",data:{query:"ReadSingleUserConversation",parameters:s},on:{success:function(t,n){if(n.status===304){r(null,o);return}u=e.JSON.parse(n.responseText),o.updateConversation(u),o.fire("readSuccess"),r(null,o)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),o.fire("readError"),r("Cannot read conversation",n)}}});return;default:r("Invalid action")}},updateConversation:function(t){var n=this.get("messageList"),r=this.get("serverTimeOffset"),i,s=[],o,u,a;this.setAttrs({etag:t.etag,unreadMessagesCount:t.unreadMessagesCount}),o=n.getNotAcknowledged();for(a=0;a<t.messages.length;a++)u=new e.LIMS.Model.MessageItemModel(t.messages[a]),i=u.get("createdAt"),u.set("createdAt",i+r),s.push(u),a+1===t.messages.length&&this.set("lastMessage",u);for(a=0;a<o.length;a++)s.push(o[a]);n.reset(s),this.fire("messagesUpdated",{messageList:n})}},{ATTRS:{conversationId:{value:null},title:{value:""},creator:{value:null},participants:{value:""},etag:{value:null},unreadMessagesCount:{value:0},lastMessage:{setter:function(t){return t?t.name!=="messageItemModel"?new e.LIMS.Model.MessageItemModel(t):t:null}},serverTimeOffset:{value:null},messageList:{valueFn:function(){return new e.LIMS.Model.MessageListModel}}}}),e.namespace("LIMS.Model"),e.LIMS.Model.ConversationListModel=e.Base.create("conversationListModel",e.ModelList,[e.LIMS.Model.ModelExtension],{model:e.LIMS.Model.ConversationModel,containsConversation:function(e){return this.getByConversationId(e)!==null},getByConversationId:function(t){var n;return n=e.Array.filter(this.toArray(),function(e){return e.get("conversationId")===t}),n.length>0?n[0]:null},updateConversationList:function(t){var n,r,i=[];for(n=0;n<t.length;n++)r=t[n],i.push(new e.LIMS.Model.ConversationModel(r));this.reset(i),this.fire("conversationsUpdated",{conversationList:this})},sync:function(t,n,r){var i=this,s;switch(t){case"read":e.io(this.getServerRequestUrl(),{method:"GET",data:{query:"ReadOpenedConversations"},timeout:3e4,on:{success:function(t,n){s=e.JSON.parse(n.responseText),i.updateConversationList(s),r(null,s)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),r("Cannot read conversations",n)}}});return;case"create":case"delete":case"update":break;default:r("Invalid action")}}},{}),e.namespace("LIMS.Model"),e.LIMS.Model.MessageItemModel=e.Base.create("messageItemModel",e.Model,[e.LIMS.Model.ModelExtension],{sync:function(t,n,r){var i,s,o=this;switch(t){case"create":o.fire("messageBegin"),s={conversationId:this.get("conversationId")},s=e.JSON.stringify(s),i=e.JSON.stringify(this.toJSON()),o.set("acknowledged",!1),e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"CreateMessage",parameters:s,content:i},on:{success:function(){o.set("acknowledged",!0),o.set("error",!1),o.fire("messageSent"),r&&r(null,o)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),o.set("acknowledged",!1),o.set("error",!0),o.fire("messageError"),r&&r("Cannot send message",n.responseText)}}});break;case"read":case"update":case"delete":break;default:r("Invalid action")}}},{ATTRS:{conversationId:{value:""},from:{setter:function(t){return t.name!=="buddyModelItem"?new e.LIMS.Model.BuddyModelItem(t):t}},body:{value:""},createdAt:{value:null},acknowledged:{value:!0},error:{value:!1}}}),e.namespace("LIMS.Model"),e.LIMS.Model.MessageListModel=e.Base.create("messageListModel",e.ModelList,[],{model:e.LIMS.Model.MessageItemModel,getNotAcknowledged:function(){return e.Array.filter(this.toArray(),function(e){return e.get("acknowledged")===!1})},comparator:function(e){return e.get("createdAt")}},{ATTRS:{}}),e.namespace("LIMS.Model"),e.LIMS.Model.PropertiesModel=e.Base.create
("propertiesModel",e.Model,[e.LIMS.Model.ModelExtension],{sync:function(t,n,r){var i;switch(t){case"create":case"update":i=e.JSON.stringify(this.toJSON()),e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"PatchProperties",content:i},on:{success:function(){r&&r(null)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),r&&r("Cannot update property")}}});break;case"read":case"delete":break;default:r&&r("Invalid action")}}},{ATTRS:{buddyListStrategy:{value:null},buddyListSocialRelations:{value:null},buddyListIgnoreDeactivatedUser:{value:null},excludedSites:{value:null},buddyListSiteExcludes:{value:null},buddyListGroupExcludes:{value:null}}}),e.namespace("LIMS.Model"),e.LIMS.Model.GroupModelItem=e.Base.create("groupModelItem",e.Model,[],{sync:function(e,t,n){var r;switch(e){case"create":r=this.toJSON();return;case"read":return;case"update":return;case"delete":return;default:n("Invalid action")}}},{ATTRS:{name:{value:""},buddies:{value:[]},socialRelation:{setter:function(t){return t?t.name!=="groupSocialRelationType"?new e.LIMS.Model.GroupSocialRelationType({socialRelationType:t}):t:null}}}}),e.namespace("LIMS.Model"),e.LIMS.Model.GroupModelList=e.Base.create("groupModelList",e.ModelList,[e.LIMS.Model.ModelExtension],{model:e.LIMS.Model.GroupModelItem,sync:function(t,n,r){var i,s=this.get("etag"),o=this;switch(t){case"read":i=e.JSON.stringify({etag:s}),e.io(this.getServerRequestUrl(),{method:"GET",data:{query:"GetGroupList",parameters:i},timeout:3e4,on:{success:function(t,n){if(n.status===304){r(null);return}var i,u,a,f,l;u=e.JSON.parse(n.responseText),a=u.groups;if(u.etag&&s.toString()!==u.etag.toString()){o.fire("groupReset"),o.set("etag",u.etag);for(i=0;i<a.length;i++)f=new e.LIMS.Model.GroupModelItem(a[i]),l=new e.LIMS.Model.BuddyModelList,l.add(a[i].buddies),f.set("buddies",l),o.add(f);o.fire("groupsReadSuccess",{groupsList:o})}r&&r(null)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),o.set("etag",-1),o.fire("groupsReadError"),r&&r("group model error",n.responseText)}}});break;case"create":case"delete":case"update":break;default:r("Invalid action")}}},{ATTRS:{etag:{value:-1}}}),e.namespace("LIMS.Model"),e.LIMS.Model.GroupSocialRelationType=e.Base.create("groupSocialRelationType",e.Model,[],{getLocalizedName:function(){var t=this.get("socialRelationType");switch(t){case"TYPE_BI_UNKNOWN":return e.LIMS.Core.i18n.values.socialRelationUnknown;case"TYPE_BI_CONNECTION":return e.LIMS.Core.i18n.values.socialRelationConnection;case"TYPE_BI_COWORKER":return e.LIMS.Core.i18n.values.socialRelationCoworker;case"TYPE_BI_FRIEND":return e.LIMS.Core.i18n.values.socialRelationFriend;case"TYPE_BI_ROMANTIC_PARTNER":return e.LIMS.Core.i18n.values.socialRelationRomanticPartner;case"TYPE_BI_SIBLING":return e.LIMS.Core.i18n.values.socialRelationSibling;default:return""}}},{ATTRS:{socialRelationType:{value:null}}}),e.namespace("LIMS.Model"),e.LIMS.Model.SettingsModel=e.Base.create("settingsModel",e.Model,[e.LIMS.Model.ModelExtension],{isMute:function(){return this.get("isMute")},updateActivePanel:function(t,n){var r;this.set("activePanelId",t),r=e.JSON.stringify(this.toJSON()),e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"UpdateActivePanel",content:r},on:{success:function(e,t){n&&n(null,t.responseText)},failure:function(t,r){r.status===401&&e.fire("userSessionExpired"),n&&n("Cannot update active panel",r.responseText)}}})},sync:function(t,n,r){var i;i=e.JSON.stringify(this.toJSON());switch(t){case"create":case"update":e.io(this.getServerRequestUrl(),{method:"POST",data:{query:"UpdateSettings",content:i},on:{success:function(){r(null)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),r("Cannot update settings")}}});break;case"read":case"delete":break;default:r("Invalid action")}}},{ATTRS:{buddy:{value:null},activePanelId:{value:null},isMute:{value:!1},isAdminAreaOpened:{value:!1}}}),e.namespace("LIMS.Model"),e.LIMS.Model.ServerTimeModel=e.Base.create("settingsModel",e.Model,[e.LIMS.Model.ModelExtension],{sync:function(t,n,r){var i,s,o,u,a=this;switch(t){case"read":s=(new Date).getTime(),e.io(this.getServerRequestUrl(),{method:"GET",data:{query:"GetServerTime"},on:{success:function(t,n){o=(new Date).getTime(),u=o-s,i=e.JSON.parse(n.responseText),a.setAttrs(i),a.set("time",a.get("time")+u),r&&r(null,a)},failure:function(t,n){n.status===401&&e.fire("userSessionExpired"),r&&r("Cannot read server time",n.responseText)}}});break;case"create":case"update":case"delete":break;default:r&&r("Invalid action")}}},{ATTRS:{time:{value:null}}})},"@VERSION@",{requires:["io","json","model","model-list"]}),YUI.add("lims-view",function(e,t){if(!e.one("#lims-container .lims-bar"))return;e.namespace("LIMS.View"),e.LIMS.View.ViewExtension=function(){},e.LIMS.View.ViewExtension.prototype={rootNode:"#lims-container",getPortraitUrl:function(t){var n=e.LIMS.Core.Properties.pathImage,r=t.get("male"),i=t.get("portraitId"),s=t.get("portraitToken"),o=t.get("portraitImageToken"),u,a;return r===!0?u="/user_male_portrait":r===!1?u="/user_female_portrait":u="/user_portrait",a=n+u+"?img_id="+i,o&&(a+="&img_id_token="+o),s&&(a+="&t="+s),a},getRootNode:function(){return e.one(this.rootNode)},hasIESupport:function(){return e.one(this.rootNode).hasClass("ie-support")}},e.namespace("LIMS.View"),e.LIMS.View.ConversationItemView=e.Base.create("conversationViewItem",e.View,[],{containerTemplate:'<li class="conversation-item"/>',model:e.LIMS.Model.MessageItemModel,template:e.one("#lims-conversation-item-template").get("innerHTML"),errorTemplate:e.one("#lims-conversation-item-error-template").get("innerHTML"),initializer:function(){this._attachEvents()},render:function(){var t=this.get("container"),n=this.get("model"),r=n.get("from"),i,s=this.get("dateFormatter");return i=n.get("body"),i=e.Escape.html(i),i=e.LIMS.Core.Util.linkify(i),t.set("innerHTML",e.Lang.sub(this.template,{createdPrettified:s.prettyDate(n.get("createdAt")),created:s.formatDate(new Date(n.get("createdAt"))),fullName
:r.printableName(),content:i,portrait:this._renderPortrait(r)})),this.set("dateNode",t.one(".conversation-item-date")),this.set("messageTextNode",t.one(".conversation-item-text")),this._addSubviews(),this},_addSubviews:function(){var t=this.get("container"),n=this.get("model"),r=this.get("errorContainer"),i=this;r&&r.remove(),n.get("acknowledged")===!0&&this._brightMessageText(!1),n.get("error")===!0&&(r=e.Node.create(e.Lang.sub(this.errorTemplate)),t.append(r),t.one(".delete-button").on("click",function(e){e.preventDefault(),i._onDeleteButtonClick()}),t.one(".resend-button").on("click",function(e){e.preventDefault(),i._onResendButtonClick()}),this.set("errorContainer",r)),n.get("error")===!1&&r!==null&&r.remove()},updateTimestamp:function(){var e=this.get("dateNode"),t=this.get("dateFormatter"),n=this.get("model");e.set("innerHTML",t.prettyDate(n.get("createdAt")))},_attachEvents:function(){var e=this.get("model");e.after("messageBegin",this._onMessageBegin,this),e.after("messageSent",this._onMessageSent,this),e.after("messageError",this._onMessageError,this),e.after("destroy",this._onDestroy,this)},_renderPortrait:function(t){var n=new e.LIMS.View.PortraitView({buddy:t});return n.render(),n.get("container").get("outerHTML")},_dimMessageText:function(){var e=this.get("messageTextNode");e.setStyle("opacity",.5)},_brightMessageText:function(t){var n=this.get("messageTextNode"),r;t?(r=new e.Anim({node:n,duration:.1,from:{opacity:.6},to:{opacity:1}}),r.run()):n.setStyle("opacity",1)},_onMessageBegin:function(){this._dimMessageText()},_onMessageSent:function(){this._addSubviews(),this._brightMessageText(!0)},_onMessageError:function(){this._addSubviews(),this._dimMessageText()},_onResendButtonClick:function(){var t=this.get("model"),n=this.get("container").one(".resend-button"),r=this.get("container").one(".delete-button");n.hasClass("preloader")||(n.addClass("preloader"),e.LIMS.Core.Util.hide(r),t.save())},_onDeleteButtonClick:function(){var e=this.get("model");e.destroy()},_onDestroy:function(){var e=this.get("container");e.remove(),this.destroy({remove:!0})}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},dateNode:{value:null},messageTextNode:{value:null},model:{value:null},dateFormatter:{valueFn:function(){return new e.LIMS.Core.DateFormatter}},errorContainer:{value:null}}}),e.namespace("LIMS.View"),e.LIMS.View.ConversationListView=e.Base.create("conversationListView",e.View,[],{model:e.LIMS.Model.MessageListModel,heightMonitorTemplate:'<pre class="chat-height-monitor"/>',initializer:function(){return this._attachEvents(),this},updateTimestamps:function(){var e,t=this.get("conversationItemViews"),n;for(e=0;e<t.length;e++)n=t[e],n.updateTimestamp()},scrollToBottom:function(){var e=this.get("panelContent");setTimeout(function(){e.set("scrollTop",e.get("scrollHeight"))},1)},setTextFieldFocus:function(){var e=this.get("messageTextField");e.focus()},showView:function(){this._showPanelInput(),this._showListView()},hideView:function(){this._hidePanelInput(),this._hideListView()},_attachEvents:function(){var e=this.get("messageTextField"),t=this.get("model");e&&(e.on("keyup",this._onMessageTextFieldKeyUp,this),e.on("focus",this._onMessageTextFieldFocus,this),e.on("blur",this._onMessageTextFieldBlur,this)),t.after("messageAdded",this._onMessageAdded,this),t.after("messageError",this._onMessageError,this),t.after("messagesUpdated",this._onMessagesUpdated,this)},_onMessageTextFieldFocus:function(e){var t=this.get("hasMessageTextFieldFocus");t===!1&&(this.set("hasMessageTextFieldFocus",!0),this.fire("messageTextFieldFocus")),this._onMessageTextFieldUpdated(e)},_onMessageTextFieldBlur:function(){var e=this.get("hasMessageTextFieldFocus");e===!0&&(this.set("hasMessageTextFieldFocus",!1),this.fire("messageTextFieldBlur"))},_onMessageTextFieldKeyUp:function(e){this._onMessageTextFieldUpdated(e)},_onMessageAdded:function(e){this._addMessage(e.message),this.scrollToBottom()},_onMessagesUpdated:function(){e.LIMS.Core.Util.hide(this.get("activityIndicator")),this._renderMessagesList(),this.set("shouldAnimateList",!1)},_onMessageError:function(){this.scrollToBottom()},_addMessage:function(t){var n,r=this.get("panelContentList"),i=this.get("conversationItemViews");n=new e.LIMS.View.ConversationItemView({model:t}),i.push(n),n.render(),r.append(n.get("container"))},_renderMessagesList:function(){var e=this,t=this.get("model").get("messageList"),n=this.get("shouldAnimateList");this._hideListView(),this._resetListView(),t.each(function(t){e._addMessage(t,!1)}),this._showListView(n),this.scrollToBottom()},_resetListView:function(){var e=this.get("panelContentList");e.set("innerHTML",""),this.set("conversationItemViews",[])},_showListView:function(t){var n=this.get("panelContentList"),r=new e.Anim({node:n,duration:.5,from:{opacity:0},to:{opacity:1}});t&&n.setStyle("opacity",0),e.LIMS.Core.Util.show(n),t&&r.run()},_hideListView:function(){var t=this.get("panelContentList");e.LIMS.Core.Util.hide(t)},_showPanelInput:function(){var t=this.get("panelInput"),n=this.get("messageTextField"),r;t.hasClass("covered")&&(t.removeClass("covered"),t.setStyle("opacity",0),n.removeAttribute("readonly"),n.focus(),r=new e.Anim({node:t,duration:.2,from:{opacity:0},to:{opacity:1}}),r.run())},_hidePanelInput:function(){var e=this.get("panelInput"),t=this.get("messageTextField");e.setStyle("opacity",0),e.addClass("covered"),t.setAttribute("readonly","readonly"),t.blur()},_onMessageTextFieldUpdated:function(t){var n=this.get("messageTextField"),r;r=n.get("value").replace(/\n|\r/gim,""),r=e.Lang.trim(r),t.keyCode===13&&!t.shiftKey&&r.length&&(t.preventDefault(),n.set("value",""),this.fire("messageSubmitted",{message:r})),this._resizeMessageTextField()},_resizeMessageTextField:function(){var t=this.get("heightMonitor").getDOM(),n=this.get("messageTextField").getDOM(),r=this.get("panelContent"),i=this.get("panelContentHeightCached"),s=this.get("messageTextFieldHeightCached"),o=this.get("maxMessageTextFieldHeight"
),u=this.get("minMessageTextFieldHeight"),a=this.get("panelInputHeight"),f=this.get("panelInputOffset"),l=n.value,c,h;h=e.config.doc.createTextNode(l),t.innerHTML="",t.appendChild(h),l=t.innerHTML,l.length||(l="&nbsp;&nbsp;"),e.LIMS.Core.Properties.isIE&&(l=l.replace(/\n/g,"<br />")),t.innerHTML=l,c=Math.min(Math.max(t.offsetHeight-4,u),o),c!==s&&(this.set("messageTextFieldHeightCached",c),n.style.height=c+"px",n.parentNode.style.height=c+f+"px",n.style.overflowY=c===o?"scroll":"hidden",r.setStyle("height",i+a-(c+f)),this.scrollToBottom())}},{ATTRS:{container:{value:null},model:{value:null},conversationItemViews:{value:[]},panelContent:{valueFn:function(){return this.get("container").one(".panel-content")}},panelContentHeightCached:{value:250},panelContentList:{valueFn:function(){return this.get("container").one(".panel-content ul")}},activityIndicator:{valueFn:function(){return this.get("container").one(".preloader")}},shouldAnimateList:{value:!0},messageTextField:{valueFn:function(){return this.get("container").one(".panel-input textarea")}},hasMessageTextFieldFocus:{value:!1},panelInput:{valueFn:function(){return this.get("container").one(".panel-input")}},panelInputHeight:{value:34},panelInputOffset:{value:12},messageTextFieldHeightCached:{value:0},maxMessageTextFieldHeight:{value:64},minMessageTextFieldHeight:{value:14},heightMonitor:{valueFn:function(){var t=e.Node.create(this.heightMonitorTemplate);return t.setStyle("width",248),t.appendTo(this.get("container")),t}}}}),e.namespace("LIMS.View"),e.LIMS.View.ChoiceElementView=e.Base.create("choiceElementView",e.View,[],{initializer:function(){this._attachEvents()},enable:function(){var e=this.get("buttonGroup");e.setStyle("opacity",1),e.removeClass("disabled")},disable:function(){var e=this.get("buttonGroup");e.setStyle("opacity",.5),e.addClass("disabled")},reset:function(){var e=this.get("selectedChoices"),t,n;for(n=0;n<e.length;n++)t=this._getChoiceNode(e[n]),t.removeClass("active");this.set("selectedChoices",[])},selectChoice:function(e){var t=this.get("container"),n=this.get("isExclusive"),r=this;return n?(t.all(".button").each(function(e){r._deactivateChoice(e.getAttribute("data-choice"))}),this._activateChoice(e)):this._isActiveChoice(e)?this._deactivateChoice(e):this._activateChoice(e)},selectChoices:function(e){var t;for(t=0;t<e.length;t++)this.selectChoice(e[t])},deselectChoice:function(e){return this._deactivateChoice(e)},_attachEvents:function(){var e=this.get("container");e.delegate("click",this._onChoiceClick,"label",this)},_activateChoice:function(e){var t=this.get("selectedChoices"),n=this._getChoiceNode(e);return n?(t.push(n.getAttribute("data-choice")),n.addClass("active"),!0):!1},_deactivateChoice:function(e){var t=this.get("selectedChoices"),n=this.get("isExclusive"),r=this._getChoiceNode(e),i;if(!r)return!1;if(n||this._checkMinThreshold()){for(i=t.length;i>=0;i--)t[i]===e&&t.splice(i,1);return r.removeClass("active"),!0}return!1},_isActiveChoice:function(e){var t=this._getChoiceNode(e);return t?t.hasClass("active"):!1},_checkMinThreshold:function(){var e=this.get("selectedChoices"),t=this.get("minChoices");return e.length>t},_getChoiceNode:function(e){var t=this.get("container"),n=null;return t.all(".button").each(function(t){t.getAttribute("data-choice")===e&&(n=t)}),n},_onChoiceClick:function(e){var t=e.currentTarget,n=this.get("selectedChoices").slice(0),r=t.getAttribute("data-choice"),i=this.get("buttonGroup").hasClass("disabled");i||this.selectChoice(r)&&this.fire("choiceClick",{choice:r,preSelectedChoices:n,postSelectedChoices:this.get("selectedChoices")})}},{ATTRS:{container:{value:null},buttonGroup:{valueFn:function(){return this.get("container").one(".button-group")}},selectedChoices:{valueFn:function(){var e=this.get("container"),t=[];return e.all(".active").each(function(e){t.push(e.getAttribute("data-choice"))}),t}},isExclusive:{value:!0},minChoices:{value:1}}}),e.namespace("LIMS.View"),e.LIMS.View.SwitchElementView=e.Base.create("switchElementView",e.View,[e.LIMS.View.ViewExtension],{initializer:function(){this._attachEvents()},isOn:function(){var e=this.get("checkbox");return e.get("checked")?!0:!1},turnOn:function(){var e=this.get("checkbox");e.set("checked","checked")},turnOff:function(){var e=this.get("checkbox");e.set("checked",null)},toggle:function(){this.isOn()?this.turnOff():this.turnOn()},enable:function(){var e=this.get("checkbox");e.set("disabled",null)},disable:function(){var e=this.get("checkbox");e.set("disabled",!0)},_attachEvents:function(){var e=this.get("checkbox");e.on("click",this._onCheckboxClick,this)},_onCheckboxClick:function(){this.fire("switchClick")}},{ATTRS:{container:{value:null},checkbox:{valueFn:function(){var e=this.get("container").one("input[type=checkbox]");return this.hasIESupport()&&e.ancestor().removeClass("switch"),e}}}}),e.namespace("LIMS.View"),e.LIMS.View.TokenInputElementView=e.Base.create("tokenInputElementView",e.View,[],{initializer:function(){this._attachEvents(),this._bind()},setValues:function(e){var t=this.get("inputNode");t.tokenInputPlugin.set("tokens",e)},enable:function(){var e=this.get("container");e.removeClass("disabled"),e.all("input").set("disabled",null),this.set("isDisabled",!1)},disable:function(){var e=this.get("container");e.addClass("disabled"),e.all("input").set("disabled","disabled"),this.set("isDisabled",!0)},focus:function(){var e=this.get("tokenInputNode");e.focus()},blur:function(){var e=this.get("tokenInputNode");e.blur()},_attachEvents:function(){var e=this.get("inputNode");e.tokenInputPlugin.on("tokensChange",this._onTokensChange,this)},_bind:function(){var e=this.get("container");e.hasClass("disabled")&&this.disable()},_onTokensChange:function(e){var t=this.get("preValue");if(t===e.newVal)return;this.set("preValue",e.prevVal),this.set("value",e.newVal),this.fire("inputUpdate",{preValue:this.get("preValue"),postValue:e.newVal},this)}},{ATTRS:{container:{value:null},inputNode:{valueFn:function(){var t=this.get("container").one("input"
);return t.plug(e.Plugin.TokenInputPlugin,{removeButton:!0}),t}},tokenInputNode:{valueFn:function(){return this.get("inputNode").tokenInputPlugin.get("inputNode")}},value:{value:[]},preValue:{value:[]},isDisabled:{value:!1}}}),e.namespace("LIMS.View"),e.LIMS.View.ErrorNotificationView=e.Base.create("errorNotificationView",e.View,[],{errorTemplate:e.one("#lims-error-notification-template").get("innerHTML"),showErrorMessage:function(t){var n=this.get("errorContainer"),r=this.get("resendButton"),i=this.get("container"),s,o=this;n.inDoc()||(n.one(".resend-button").on("click",function(e){e.preventDefault(),r.hasClass("activated")||(r.addClass("activated"),o.fire("resendButtonClick"))}),t?(s=new e.Anim({node:n,duration:.3,from:{opacity:0},to:{opacity:1}}),n.setStyle("opacity",0),i.append(n),s.run()):i.append(n)),n.one(".resend-button").removeClass("activated"),this.layoutSubviews()},hideErrorMessage:function(t){var n=this.get("errorContainer"),r;n.inDoc()&&(t?(r=new e.Anim({node:n,duration:.3,from:{opacity:1},to:{opacity:0}}),r.on("end",function(){r.get("node").remove()}),r.run()):n.remove())},layoutSubviews:function(){var e=this.get("errorContainer"),t=this.get("errorMessageContainer"),n;t.setStyle("margin-top",0),n=e.get("clientHeight")/2-t.get("clientHeight"),t.setStyle("margin-top",n)}},{ATTRS:{container:{value:null},errorMessage:{value:null},errorContainer:{valueFn:function(){var t=this.get("errorMessage");return e.Node.create(e.Lang.sub(this.errorTemplate,{errorMessage:t}))}},errorMessageContainer:{valueFn:function(){return this.get("errorContainer").one(".error-message")}},resendButton:{valueFn:function(){return this.get("errorContainer").one(".resend-button")}}}}),e.namespace("LIMS.View"),e.LIMS.View.InfoNotificationView=e.Base.create("infoNotificationView",e.View,[],{infoTemplate:e.one("#lims-info-notification-template").get("innerHTML"),showInfoMessage:function(t){var n=this.get("infoContainer"),r=this.get("container"),i;n.inDoc()||(t?(i=new e.Anim({node:n,duration:.5,from:{opacity:0},to:{opacity:1}}),n.setStyle("opacity",0),r.append(n),i.run()):r.append(n),this.layoutSubviews())},hideInfoMessage:function(t){var n=this.get("infoContainer"),r;n.inDoc()&&(t?(r=new e.Anim({node:n,duration:.3,from:{opacity:1},to:{opacity:0}}),r.on("end",function(){r.get("node").remove()}),r.run()):n.remove())},layoutSubviews:function(){var e=this.get("infoContainer"),t=this.get("infoMessageContainer"),n;t.setStyle("margin-top",0),n=e.get("clientHeight")/2-t.get("clientHeight"),t.setStyle("margin-top",n)}},{ATTRS:{container:{value:null},infoMessage:{value:null},infoContainer:{valueFn:function(){var t=this.get("infoMessage");return e.Node.create(e.Lang.sub(this.infoTemplate,{infoMessage:t}))}},infoMessageContainer:{valueFn:function(){return this.get("infoContainer").one(".info-message")}}}}),e.namespace("LIMS.View"),e.LIMS.View.GroupBuddyViewItem=e.Base.create("groupBuddyViewItem",e.View,[],{containerTemplate:'<li class="group-buddy-item"/>',model:e.LIMS.Model.BuddyModelItem,template:e.one("#lims-group-buddy-item-template").get("innerHTML"),render:function(){var t,n;return t=this.get("container"),n=this.get("model"),t.set("innerHTML",e.Lang.sub(this.template,{name:n.printableName(),portrait:this._getPortrait(n),presence:this._getPresence(n.get("presence"))})),this._attachEvents(),this},_attachEvents:function(){var t=this.get("model"),n=this.get("container");n.on("click",function(n){n.preventDefault(),e.fire("buddySelected",t)})},_getPortrait:function(t){var n=new e.LIMS.View.PortraitView({buddy:t});return n.render(),n.get("container").get("outerHTML")},_getPresence:function(t){var n=new e.LIMS.View.PresenceView({presenceType:t});return n.render(),n.get("container").get("outerHTML")}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},model:{value:null}}}),e.namespace("LIMS.View"),e.LIMS.View.GroupBuddyViewList=e.Base.create("groupBuddyViewList",e.View,[],{containerTemplate:'<ul class="group-buddy-list"/>',model:e.LIMS.Model.BuddyModelList,render:function(){var t,n,r,i,s;t=this.getContainer(),n=this.getModel();for(r=0;r<n.size();r++)i=n.item(r),s=new e.LIMS.View.GroupBuddyViewItem({model:i}),s.render(),t.append(s.get("container"));return this},getContainer:function(){return this.get("container")},getModel:function(){return this.get("model")}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},model:{value:null}}}),e.namespace("LIMS.View"),e.LIMS.View.GroupSearchView=e.Base.create("groupSearchView",e.View,[],{template:e.one("#lims-panel-search-template").get("innerHTML"),initializer:function(){this._attachEvents()},reset:function(){var e=this.get("searchInput"),t=this.get("errorView");e.set("value",""),e.focus(),this.render(),this._hideActivityIndicator(),this._showInfoMessage(),t.hideErrorMessage(!1)},render:function(){var t=this.get("listContainer"),n=this.get("model"),r,i,s;t.set("innerHTML","");for(s=0;s<n.size();s++)r=n.item(s),i=new e.LIMS.View.GroupBuddyViewItem({model:r}),i.render(),t.append(i.get("container"));return n.size()===0?this._showNoResultsMessage():(this._hideNoResultsMessage(),this._hideInfoMessage()),this},_attachEvents:function(){var e=this.get("searchInput"),t=this.get("model"),n=this.get("errorView");e.on("keyup",this._onSearchInputUpdate,this),t.on("searchStarted",this._onSearchStarted,this),t.on("searchSuccess",this._onSearchSuccess,this),t.on("searchError",this._onSearchError,this),n.on("resendButtonClick",this._onResendButtonClick,this)},_search:function(){var t=this.get("timer"),n=this.get("timerDelayInterval"),r=this.get("searchInput"),i=this.get("model"),s;s=r.get("value").replace(/\n|\r/gim,""),s=e.Lang.trim(s),clearTimeout(t),this.set("timer",setTimeout(function(){s!==""&&i.search(s)},n))},_showActivityIndicator:function(){var e=this.get("activityIndicator"),t=this.get("container");e.inDoc()||t.append(e)},_hideActivityIndicator:function(){var e=this.get("activityIndicator");e.inDoc()&&e.remove()},_showInfoMessage
:function(){var e=this.get("infoView"),t=this.get("infoNoResultsView");e.showInfoMessage(!1),t.hideInfoMessage(!1)},_hideInfoMessage:function(){var e=this.get("infoView");e.hideInfoMessage(!1)},_showNoResultsMessage:function(){var e=this.get("infoNoResultsView"),t=this.get("infoView");e.showInfoMessage(!1),t.hideInfoMessage(!1)},_hideNoResultsMessage:function(){var e=this.get("infoNoResultsView");e.hideInfoMessage(!1)},_onSearchInputUpdate:function(){this._search()},_onSearchStarted:function(){this._showActivityIndicator()},_onSearchSuccess:function(){var e=this.get("errorView");this._hideActivityIndicator(),this._hideNoResultsMessage(),this.render(),e.hideErrorMessage(!1)},_onSearchError:function(){var e=this.get("errorView");this._hideActivityIndicator(),this.render(),this._hideNoResultsMessage(),e.showErrorMessage(!0)},_onResendButtonClick:function(){this._search()}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.template)}},model:{value:null},searchInput:{valueFn:function(){return this.get("container").one(".search-input-field")}},searchContent:{valueFn:function(){return this.get("container").one(".search-content")}},errorView:{valueFn:function(){var t=this.get("searchContent");return new e.LIMS.View.ErrorNotificationView({container:t,errorMessage:e.LIMS.Core.i18n.values.searchErrorMessage})}},infoView:{valueFn:function(){var t=this.get("searchContent");return new e.LIMS.View.InfoNotificationView({container:t,infoMessage:e.LIMS.Core.i18n.values.searchInfoMessage})}},infoNoResultsView:{valueFn:function(){var t=this.get("searchContent");return new e.LIMS.View.InfoNotificationView({container:t,infoMessage:e.LIMS.Core.i18n.values.searchNoResultsMessage})}},listContainer:{valueFn:function(){return this.get("container").one(".group-buddy-list")}},activityIndicator:{valueFn:function(){return this.get("container").one(".preloader")}},timer:{value:null},timerDelayInterval:{value:500}}}),e.namespace("LIMS.View"),e.LIMS.View.GroupViewItem=e.Base.create("groupViewItem",e.View,[],{containerTemplate:'<li class="group-item"/>',model:e.LIMS.Model.GroupModelItem,template:e.one("#lims-group-item-template").get("innerHTML"),render:function(){var t=this.get("container"),n=this.get("model"),r=n.get("socialRelation"),i,s;return r?s=r.getLocalizedName():s=n.get("name"),t.set("innerHTML",e.Lang.sub(this.template,{name:s})),n.get("name")||e.LIMS.Core.Util.hide(t.one(".group-name")),i=new e.LIMS.View.GroupBuddyViewList({model:n.get("buddies")}),i.render(),t.append(i.get("container")),this}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},model:{value:null}}}),e.namespace("LIMS.View"),e.LIMS.View.GroupViewList=e.Base.create("groupViewList",e.View,[],{model:e.LIMS.Model.GroupModelList,initializer:function(){this._attachEvents()},_attachEvents:function(){var e=this.get("model"),t=this.get("errorView");e.after("add",this._onGroupAdd,this),e.on("groupReset",this._onGroupReset,this),e.after("groupsReadSuccess",this._onGroupsReadSuccess,this),e.after("groupsReadError",this._onGroupsReadError,this),t.on("resendButtonClick",this._onResendButtonClick,this)},_onGroupsReadSuccess:function(){var t=this.get("activityIndicator"),n=this.get("errorView"),r=this.get("infoView"),i=this.get("model");n.hideErrorMessage(!0),i.isEmpty()?(r.showInfoMessage(!0),this._hideGroups()):(this._showGroups(),r.hideInfoMessage(!0)),e.LIMS.Core.Util.hide(t)},_onGroupsReadError:function(){var t=this.get("activityIndicator"),n=this.get("infoView"),r=this.get("errorView");e.LIMS.Core.Util.hide(t),this._hideGroups(),n.hideInfoMessage(!0),r.showErrorMessage(!0)},_onGroupReset:function(){var e=this.get("groupList");e&&e.set("innerHTML","")},_onGroupAdd:function(t){var n=new e.LIMS.View.GroupViewItem({model:t.model}),r=this.get("groupList");r&&n&&(n.render(),r.append(n.get("container")))},_onResendButtonClick:function(){var e=this.get("model");e.load()},_showGroups:function(){var t=this.get("groupList"),n=this.get("container"),r;t&&!t.inDoc()&&(r=new e.Anim({node:t,duration:.5,from:{opacity:0},to:{opacity:1}}),t.setStyle("opacity",0),n.append(t),r.run())},_hideGroups:function(){var t=this.get("groupList"),n;t&&t.inDoc()&&(n=new e.Anim({node:t,duration:.5,from:{opacity:1},to:{opacity:0}}),n.on("end",function(){n.get("node").remove()}),n.run())}},{ATTRS:{container:{value:null},model:{value:null},groupList:{valueFn:function(){var e=this.get("container").one(".group-list");return e&&e.remove(),e}},activityIndicator:{value:null},errorView:{valueFn:function(){var t=this.get("container");return new e.LIMS.View.ErrorNotificationView({container:t,errorMessage:e.LIMS.Core.i18n.values.groupListErrorMessage})}},infoView:{valueFn:function(){var t=this.get("container");return new e.LIMS.View.InfoNotificationView({container:t,infoMessage:e.LIMS.Core.i18n.values.groupListEmptyInfoMessage})}}}}),e.namespace("LIMS.View"),e.LIMS.View.PortraitView=e.Base.create("portraitView",e.View,[e.LIMS.View.ViewExtension],{containerTemplate:'<img alt="" class="portrait"/>',render:function(){var e=this.get("container"),t=this.get("buddy");return e.set("src",this.getPortraitUrl(t)),this}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},buddy:{value:null}}}),e.namespace("LIMS.View"),e.LIMS.View.PresenceView=e.Base.create("presenceView",e.View,[],{containerTemplate:'<div class="status-indicator"/>',render:function(){var e=this.get("presenceType"),t=this.get("container");switch(e){case"ACTIVE":t.addClass("online");break;case"AWAY":t.addClass("busy");break;case"DND":t.addClass("unavailable");break;case"OFFLINE":t.addClass("off");break;default:t.addClass("off")}return this}},{ATTRS:{container:{valueFn:function(){return e.Node.create(this.containerTemplate)}},presenceType:{value:"UNRECOGNIZED"}}}),e.namespace("LIMS.View"),e.LIMS.View.PropertiesView=e.Base.create("propertiesView",e.View,[],{initializer:function(){this._attachEvents()},toggleView:function(){var e=this.get("openAnimation");e.run()},isOpened
:function(){return this.get("settingsContainer").hasClass("opened")},_attachEvents:function(){var e=this.get("openButton"),t=this.get("buddyListStrategy"),n=this.get("buddyListSocialRelations"),r=this.get("buddyListIgnoreDeactivatedUser"),i=this.get("excludedSites"),s=this.get("buddyListSiteExcludes"),o=this.get("buddyListGroupExcludes");e.on("click",this._onOpenButtonClick,this),t.on("choiceClick",this._onBuddyListStrategySelected,this),n.on("choiceClick",this._onBuddyListSocialRelationsSelected,this),r.on("switchClick",this._onBuddyListIgnoreDeactivatedUserClick,this),i.on("inputUpdate",this._onExcludedSitesUpdate,this),s.on("inputUpdate",this._onBuddyListSiteExcludesUpdate,this),o.on("inputUpdate",this._onBuddyListGroupExcludesUpdate,this)},_onOpenButtonClick:function(){this.toggleView()},_onBuddyListStrategySelected:function(t){var n=t.choice,r=this.get("buddyListStrategy"),i=this.get("buddyListSocialRelations"),s=t.preSelectedChoices,o;o=new e.LIMS.Model.PropertiesModel({buddyListStrategy:n}),r.disable(),o.save(function(e){e?r.selectChoices(s):n==="SOCIAL"||n==="SITES_AND_SOCIAL"?i.enable():i.disable(),r.enable()})},_onBuddyListSocialRelationsSelected:function(t){var n=this.get("buddyListSocialRelations"),r=t.preSelectedChoices,i=t.postSelectedChoices,s;s=new e.LIMS.Model.PropertiesModel({buddyListSocialRelations:i}),n.disable(),s.save(function(e){e&&(n.reset(),n.selectChoices(r)),n.enable()})},_onBuddyListIgnoreDeactivatedUserClick:function(){var t=this.get("buddyListIgnoreDeactivatedUser"),n;n=new e.LIMS.Model.PropertiesModel({buddyListIgnoreDeactivatedUser:t.isOn()}),t.disable(),n.save(function(e){e&&t.toggle(),t.enable()})},_onExcludedSitesUpdate:function(t){var n=this.get("excludedSites"),r=t.preValue,i=t.postValue,s;s=new e.LIMS.Model.PropertiesModel({excludedSites:i}),n.disable(),s.save(function(e){e&&n.setValues(r),n.enable(),n.focus()})},_onBuddyListSiteExcludesUpdate:function(t){var n=this.get("buddyListSiteExcludes"),r=t.preValue,i=t.postValue,s;s=new e.LIMS.Model.PropertiesModel({buddyListSiteExcludes:i}),n.disable(),s.save(function(e){e&&n.setValues(r),n.enable(),n.focus()})},_onBuddyListGroupExcludesUpdate:function(t){var n=this.get("buddyListGroupExcludes"),r=t.preValue,i=t.postValue,s;s=new e.LIMS.Model.PropertiesModel({buddyListGroupExcludes:i}),n.disable(),s.save(function(e){e&&n.setValues(r),n.enable(),n.focus()})}},{ATTRS:{container:{value:null},settingsContainer:{valueFn:function(){return this.get("container").one(".settings")}},openButton:{valueFn:function(){return this.get("container").one(".open-button")}},helpButton:{valueFn:function(){return this.get("container").one(".help")}},openAnimation:{valueFn:function(){var t=this.get("openButtonAnimation"),n=this.get("settingsContainer"),r=this.get("openButton"),i=this.get("helpButton"),s;return s=new e.Anim({node:n,duration:.8,from:{width:250,height:0,opacity:0},to:{width:440,height:300,opacity:1},easing:"backOut"}),n.hasClass("opened")&&s.set("reverse",!0),s.before("start",function(){r.setStyle("opacity",0),e.LIMS.Core.Util.hide(r),e.LIMS.Core.Util.hide(i)},this),s.after("end",function(){s.get("reverse")?(r.set("innerHTML",e.LIMS.Core.i18n.values.adminAreaOpen),n.removeClass("opened"),n.addClass("closed"),n.setStyle("opacity",0),this.fire("propertiesClosed")):(r.set("innerHTML",e.LIMS.Core.i18n.values.adminAreaClose),n.removeClass("closed"),n.addClass("opened"),e.LIMS.Core.Util.show(i),this.fire("propertiesOpened")),e.LIMS.Core.Util.show(r),t.run(),s.set("reverse",!s.get("reverse"))},this),s}},openButtonAnimation:{valueFn:function(){var t=this.get("openButton");return new e.Anim({node:t,duration:.5,from:{opacity:0},to:{opacity:1}})}},buddyListStrategy:{valueFn:function(){var t=this.get("container").one(".buddy-list-strategy");return new e.LIMS.View.ChoiceElementView({container:t})}},buddyListSocialRelations:{valueFn:function(){var t=this.get("container").one(".buddy-list-social-relations");return new e.LIMS.View.ChoiceElementView({container:t,isExclusive:!1})}},buddyListIgnoreDeactivatedUser:{valueFn:function(){var t=this.get("container").one(".buddy-list-ignore-deactivated-user");return new e.LIMS.View.SwitchElementView({container:t})}},excludedSites:{valueFn:function(){var t=this.get("container").one(".excluded-sites");return new e.LIMS.View.TokenInputElementView({container:t})}},buddyListSiteExcludes:{valueFn:function(){var t=this.get("container").one(".buddy-list-site-excludes");return new e.LIMS.View.TokenInputElementView({container:t})}},buddyListGroupExcludes:{valueFn:function(){var t=this.get("container").one(".buddy-list-group-excludes");return new e.LIMS.View.TokenInputElementView({container:t})}}}}),e.namespace("LIMS.View"),e.LIMS.View.SettingsView=e.Base.create("settingsView",e.View,[],{initializer:function(){this._attachEvents(),this._bindSettings()},_attachEvents:function(){var e=this.get("soundSwitch");e.on("switchClick",this._onSoundSwitchClick,this)},_bindSettings:function(){var e=this.get("model"),t=this.get("soundSwitch");e.set("isMute",!t.isOn())},_onSoundSwitchClick:function(){var e=this.get("soundSwitch"),t=this.get("model");t.set("isMute",!e.isOn()),e.disable(),t.save(function(t){t&&e.toggle(),e.enable()})}},{ATTRS:{container:{value:null},model:{value:null},soundSwitch:{valueFn:function(){var t=this.get("container").one(".play-sound");return new e.LIMS.View.SwitchElementView({container:t})}}}}),e.namespace("LIMS.View"),e.LIMS.View.PanelView=e.Base.create("panelView",e.View,[],{errorTemplate:e.one("#lims-panel-error-template").get("innerHTML"),initializer:function(t){this.set("container",t.container),this.set("panelId",t.panelId),t.container.hasClass("selected")&&(e.fire("panelShown",this),this.set("isOpened",!0)),this._attachEvents()},show:function(){var t=this.get("container");t.removeClass("closed"),t.addClass("selected"),this.set("isOpened",!0),e.fire("panelShown",this)},hide:function(){var t=this.get("container");t.removeClass("selected"),this.set("isOpened",!1),e.fire("panelHidden",this
)},toggle:function(){var e=this.get("isOpened");e?this.hide():this.show()},close:function(){var t=this.get("container");t.addClass("closed"),this.set("isOpened",!1),e.fire("panelClosed",this)},showError:function(t){var n=this.get("panelTitle"),r=this.get("errorContainer"),i=r.one(".error-message"),s;i.set("innerHTML",t),r.inDoc()||(s=new e.Anim({node:r,duration:.5,from:{opacity:0},to:{opacity:1}}),r.setStyle("opacity",0),n.insert(r,"after"),s.run())},hideError:function(){var t=this.get("errorContainer"),n;t.inDoc()&&(n=new e.Anim({node:t,duration:.5,from:{opacity:1},to:{opacity:0}}),n.on("end",function(){n.get("node").remove()}),n.run())},_attachEvents:function(){this.get("trigger").on("click",this._onTriggerClick,this),this.get("panelButtons").on("click",this._onPanelButtonsClick,this)},_onTriggerClick:function(){this.toggle()},_onPanelButtonsClick:function(e){var t=e.currentTarget;e.preventDefault();if(t.hasClass("minimize"))return this.hide(),!1;if(t.hasClass("close"))return this.close(),!1}},{ATTRS:{container:{value:null},panelId:{value:null},isOpened:{value:!1},panelTitle:{valueFn:function(){return this.get("container").one(".panel-title")}},trigger:{valueFn:function(){return this.get("container").one(".panel-trigger")}},panelButtons:{valueFn:function(){return this.get("container").all(".panel-button")}},searchContainer:{valueFn:function(){return this.get("container").one(".panel-search")}},errorContainer:{valueFn:function(){return e.Node.create(this.errorTemplate)}}}})},"@VERSION@",{requires:["view","node","anim"]}),YUI.add("lims-controller",function(e,t){if(!e.one("#lims-container .lims-bar"))return;e.namespace("LIMS.Controller"),e.LIMS.Controller.ControllerExtension=function(){},e.LIMS.Controller.ControllerExtension.prototype={rootNode:"#lims-container",getRootNode:function(){return e.one(this.rootNode)},showPortlet:function(){e.one(this.rootNode).removeClass("covered")},hidePortlet:function(){e.one(this.rootNode).addClass("covered")},hasIESupport:function(){return e.one(this.rootNode).hasClass("ie-support")}},e.namespace("LIMS.Controller"),e.LIMS.Controller.MainController=e.Base.create("mainController",e.Base,[e.LIMS.Controller.ControllerExtension],{initializer:function(){var t=this.get("buddyDetails"),n=this.get("settingsModel"),r=this.get("notification"),i=this.get("properties"),s=this.get("serverTimeModel"),o=this.get("poller"),u=this.getRootNode();this._attachEvents(),s.load(function(a){a||i.set("offset",(new Date).getTime()-s.get("time")),new e.LIMS.Controller.GroupViewController({container:u.one(".buddy-list"),properties:i,poller:o}),new e.LIMS.Controller.PresenceViewController({container:u.one(".status-panel"),buddyDetails:t}),new e.LIMS.Controller.SettingsViewController({container:u.one(".chat-settings"),model:n}),new e.LIMS.Controller.ConversationsController({container:u.one(".lims-tabs"),buddyDetails:t,settings:n,notification:r,properties:i,poller:o})})},sessionExpired:function(){e.fire("userSessionExpired")},_attachEvents:function(){e.on("initializationFinished",this._onInitializationFinished,this),e.on("panelShown",this._onPanelShown,this),e.on("panelHidden",this._onPanelHidden,this),e.on("userSessionExpired",this._onSessionExpired,this)},_onInitializationFinished:function(){this.showPortlet()},_onPanelShown:function(e){var t=e.get("panelId");this.set("activePanelId",t),this.get("settingsModel").updateActivePanel(t)},_onPanelHidden:function(e){this.get("activePanelId")===e.get("panelId")&&this.get("settingsModel").updateActivePanel(null)},_onSessionExpired:function(){e.LIMS.Core.Util.hide(this.getRootNode())}},{ATTRS:{buddyDetails:{valueFn:function(){var t=new e.LIMS.Core.Properties;return new e.LIMS.Model.BuddyModelItem({buddyId:t.getCurrentUserId(),male:t.getCurrentUserMale(),portraitId:t.getCurrentUserPortraitId(),portraitImageToken:t.getCurrentUserPortraitImageToken(),portraitToken:t.getCurrentUserPortraitToken(),screenName:t.getCurrentUserScreenName(),fullName:t.getCurrentUserFullName()})}},settingsModel:{valueFn:function(){return new e.LIMS.Model.SettingsModel({buddy:this.get("buddyDetails")})}},serverTimeModel:{valueFn:function(){return new e.LIMS.Model.ServerTimeModel}},notification:{valueFn:function(){return new e.LIMS.Core.Notification({settings:this.get("settingsModel"),container:this.getRootNode().one(".lims-sound"),properties:this.get("properties")})}},poller:{valueFn:function(){return new e.LIMS.Core.Poller}},properties:{valueFn:function(){return new e.LIMS.Core.Properties}},activePanelId:{value:null}}}),e.namespace("LIMS.Controller"),e.LIMS.Controller.ConversationsController=e.Base.create("conversationsController",e.Base,[],{containerTemplate:'<li class="conversation">',template:e.one("#lims-conversation-template").get("innerHTML"),initializer:function(){var t=this.get("properties");this._bindConversations(),this._attachEvents(),t.isChatEnabled()&&this._startPolling(),e.fire("initializationFinished")},_attachEvents:function(){var t=this.get("conversationList");t.on("conversationsUpdated",this._onConversationsUpdated,this),e.on("buddySelected",function(e){this._onBuddySelected(e)},this),e.on("userSessionExpired",this._onSessionExpired,this),e.on("chatEnabled",this._onChatEnabled,this),e.on("chatDisabled",this._onChatDisabled,this)},_generateConversationId:function(e,t){var n=[e,t];return n.sort(),n[0]+"_"+n[1]},_bindConversations:function(){var t=this.get("conversationNodes"),n=this.get("conversationMap"),r=this.get("buddyDetails"),i,s,o=this.get("settings"),u=this.get("properties"),a,f=this.get("conversationList"),l=this.get("notification"),c;t.each(function(t){i=t.attr("data-conversationId"),s=t.attr("data-unreadMessagesCount"),n.hasOwnProperty(i)||(a=new e.LIMS.Model.ConversationModel({conversationId:i,creator:r,unreadMessagesCount:s,serverTimeOffset:u.getServerTimeOffset()}),f.add(a),c=new e.LIMS.Controller.SingleUserConversationViewController({controllerId:i,container:t,model:a,buddyDetails:r,settings:o,properties:u,notification:l}),c.on("panelDidUnload"
,function(e){delete n[e.controllerId]}),n[i]=c)})},_onBuddySelected:function(t){var n=this.get("conversationMap"),r=this.get("buddyDetails"),i,s,o,u=this.get("conversationList"),a=this.get("settings"),f=this.get("properties"),l=this.get("notification"),c;i=this._generateConversationId(r.get("screenName"),t.get("screenName")),n.hasOwnProperty(i)?c=n[i]:(s=new e.LIMS.Model.ConversationModel({conversationId:i,creator:r,participants:[t],title:t.printableName(),serverTimeOffset:f.getServerTimeOffset()}),u.add(s),o=e.Node.create(this.containerTemplate),o.set("innerHTML",e.Lang.sub(this.template,{conversationTitle:s.get("title"),triggerTitle:s.get("title"),unreadMessages:s.get("unreadMessagesCount")})),this.get("container").append(o),c=new e.LIMS.Controller.SingleUserConversationViewController({buddyDetails:r,container:o,controllerId:i,model:s,settings:a,properties:f,notification:l}),s.save(),c.on("panelDidUnload",function(e){delete n[e.controllerId]}),n[i]=c),c.presentViewController()},_onConversationsUpdated:function(){var t=this.get("conversationMap"),n,r=this,i=this.get("buddyDetails"),s=this.get("conversationList"),o,u=this.get("container"),a=this.get("notification"),f=this.get("settings"),l=this.get("properties"),c;s.each(function(h){c=h.get("conversationId"),t.hasOwnProperty(c)?(n=t[c],n.updateModel(h)):h.get("unreadMessagesCount")!==0&&(h.set("creator",i),h.set("etag",0),s.add(h),o=e.Node.create(r.containerTemplate),o.set("innerHTML",e.Lang.sub(r.template,{conversationTitle:h.get("title"),triggerTitle:h.get("title"),unreadMessages:h.get("unreadMessagesCount")})),u.append(o),n=new e.LIMS.Controller.SingleUserConversationViewController({buddyDetails:i,container:o,controllerId:c,model:h,settings:f,properties:l,notification:a}),n.on("panelDidUnload",function(e){delete t[e.controllerId]}),t[c]=n,h.load(function(e){e||(n.showViewController(),a.notify(h.get("lastMessage")))}))})},_onSessionExpired:function(){this._stopPolling()},_onChatEnabled:function(){this._startPolling()},_onChatDisabled:function(){this._stopPolling()},_startPolling:function(){var t=this.get("conversationList"),n=this.get("poller");n.register("conversationController:model",new e.LIMS.Core.PollerEntry({model:t,interval:7e3,connectionMonitor:!0}))},_stopPolling:function(){var e=this.get("poller");e.unregister("conversationController:model")}},{ATTRS:{container:{value:null},conversationMap:{value:{}},buddyDetails:{value:null},properties:{value:null},settings:{value:null},conversationList:{valueFn:function(){return new e.LIMS.Model.ConversationListModel}},notification:{value:null},conversationNodes:{valueFn:function(){return this.get("container").all(".conversation")}},poller:{value:null}}}),e.namespace("LIMS.Controller"),e.LIMS.Controller.GroupViewController=e.Base.create("groupViewController",e.LIMS.Core.ViewController,[],{listButtonTemplate:'<button class="panel-button list">',initializer:function(){this.setup(this.get("container"),this.get("controllerId"))},onPanelDidLoad:function(){this._attachEvents()},onPanelDidAppear:function(){this._startPolling(),this._subscribeKeyUp()},onPanelDidDisappear:function(){this._stopPolling(),this._detachKeyUp()},onSessionExpired:function(){this._stopPolling()},_attachEvents:function(){var t=this.get("searchButton"),n=this.get("listButton");t.on("click",this._onSearchClicked,this),n.on("click",this._onSearchClosed,this),e.on("buddySelected",this._onBuddySelected,this)},_subscribeKeyUp:function(){e.one("doc")&&this.set("keyUpSubscription",e.one("doc").on("keyup",this._onKeyPress,this))},_detachKeyUp:function(){var e=this.get("keyUpSubscription");e&&e.detach()},_startPolling:function(){var t=this.get("model"),n=this.get("poller"),r=this.get("properties");r.isChatEnabled()&&n.register("groupViewController:model",new e.LIMS.Core.PollerEntry({model:t,interval:1e4}))},_stopPolling:function(){var e=this.get("poller");e.unregister("groupViewController:model")},_showSearchPanel:function(){var t=this.get("panelTitle"),n=this.get("searchPanelView"),r=this.get("searchPanelModel"),i=n.get("container"),s,o=this;i.inDoc()||(s=new e.Anim({node:i,duration:.5,from:{opacity:0},to:{opacity:1}}),s.on("end",function(){o._hideSearchButton(),o._showListButton()},this),i.setStyle("opacity",0),t.insert(i,"after"),r.reset(),n.reset(),s.run())},_hideSearchPanel:function(){var t=this.get("searchPanelView"),n=t.get("container"),r,i=this;n.inDoc()&&(r=new e.Anim({node:n,duration:.5,from:{opacity:1},to:{opacity:0}}),r.on("end",function(){r.get("node").remove(),i._hideListButton(),i._showSearchButton()},this),r.run())},_showSearchButton:function(){var t=this.get("searchButton");e.LIMS.Core.Util.show(t)},_hideSearchButton:function(){var t=this.get("searchButton");e.LIMS.Core.Util.hide(t)},_showListButton:function(){var t=this.get("listButton"),n=this.get("minimizeButton");t.inDoc()||n.insert(t,"after"),e.LIMS.Core.Util.show(t)},_hideListButton:function(){var t=this.get("listButton");e.LIMS.Core.Util.hide(t)},_onBuddySelected:function(){this.dismissViewController(),this._hideSearchPanel()},_onSearchClicked:function(){this._showSearchPanel()},_onSearchClosed:function(){this._hideSearchPanel()},_onKeyPress:function(e){e.keyCode===27&&this._hideSearchPanel()}},{ATTRS:{controllerId:{value:"groups"},container:{value:null},model:{valueFn:function(){return new e.LIMS.Model.GroupModelList}},activityIndicator:{valueFn:function(){return this.get("container").one(".panel-content .preloader")}},panelContentContainer:{valueFn:function(){return this.get("container").one(".panel-content")}},panelTitle:{valueFn:function(){return this.get("container").one(".panel-title")}},searchPanelView:{valueFn:function(){var t=this.get("searchPanelModel");return new e.LIMS.View.GroupSearchView({model:t})}},searchPanelModel:{valueFn:function(){return new e.LIMS.Model.BuddySearchListModel}},searchButton:{valueFn:function(){return this.get("container").one(".panel-title .panel-button.search")}},minimizeButton:{valueFn:function(){return this.get("container")
.one(".panel-title .panel-button.minimize")}},listButton:{valueFn:function(){return e.Node.create(this.listButtonTemplate)}},groupViewList:{valueFn:function(){var t=this.get("panelContentContainer"),n=this.get("model"),r=this.get("activityIndicator");return new e.LIMS.View.GroupViewList({container:t,model:n,activityIndicator:r})}},properties:{value:null},keyUpSubscription:{value:null},poller:{value:null}}}),e.namespace("LIMS.Controller"),e.LIMS.Controller.PresenceViewController=e.Base.create("presenceViewController",e.LIMS.Core.ViewController,[],{initializer:function(){this.setup(this.get("container"),this.get("controllerId"))},onPanelDidLoad:function(){this._attachEvents()},_attachEvents:function(){this.getPanel().get("container").delegate("click",function(t){var n,r=t.currentTarget;r.ancestor("li")&&(n=r.getAttribute("data-status"),e.fire("presenceChanged",{presence:n}))},"li"),e.on("presenceChanged",this._onPresenceChanged,this)},_onPresenceChanged:function(t){this._updatePresenceIndicator(t.presence),t.presence==="OFFLINE"?(e.fire("chatDisabled"),this.showViewController()):e.fire("chatEnabled"),this.dismissViewController()},_updatePresenceIndicator:function(e){var t=this.get("buddyDetails"),n="";switch(e){case"ACTIVE":n="online",t.updatePresence("ACTIVE");break;case"AWAY":n="busy",t.updatePresence("AWAY");break;case"DND":n="unavailable",t.updatePresence("DND");break;case"OFFLINE":n="off",t.updatePresence("OFFLINE");break;default:n="off",t.updatePresence("UNRECOGNIZED")}this.get("statusIndicator").setAttribute("class","status-indicator "+n)}},{ATTRS:{controllerId:{value:"presence"},container:{value:null},buddyDetails:{value:null},statusIndicator:{valueFn:function(){return this.get("container").one(".status-indicator")}}}}),e.namespace("LIMS.Controller"),e.LIMS.Controller.SettingsViewController=e.Base.create("settingsViewController",e.LIMS.Core.ViewController,[e.LIMS.Controller.ControllerExtension],{initializer:function(){this.setup(this.get("container"),this.get("controllerId"))},onPanelDidLoad:function(){this._attachEvents(),this._bindSettings()},_attachEvents:function(){var e=this.get("adminProperties");e&&(e.on("propertiesOpened",this._onAdminPropertiesOpened,this),e.on("propertiesClosed",this._onAdminPropertiesClosed,this))},_bindSettings:function(){var e=this.get("model"),t=this.get("adminProperties");t&&e.set("isAdminAreaOpened",t.isOpened())},_onAdminPropertiesOpened:function(){var e=this.get("model");e.set("isAdminAreaOpened",!0),e.save()},_onAdminPropertiesClosed:function(){var e=this.get("model");e.set("isAdminAreaOpened",!1),e.save()}},{ATTRS:{controllerId:{value:"settings"},container:{value:null},model:{value:null},adminProperties:{valueFn:function(){var t=this.get("container").one(".admin-area");return t?new e.LIMS.View.PropertiesView({container:t}):null}},userSettings:{valueFn:function(){var t=this.get("container").one(".user-settings"),n=this.get("model");return new e.LIMS.View.SettingsView({container:t,model:n})}}}}),e.namespace("LIMS.Controller"),e.LIMS.Controller.SingleUserConversationViewController=e.Base.create("singleUserConversationController",e.LIMS.Core.ViewController,[],{initializer:function(){this.setup(this.get("container"),this.get("controllerId"))},onPanelDidLoad:function(){var e=this.get("listView");this._attachEvents(),e.hideView()},onPanelDidAppear:function(){var e=this.get("model"),t=this.get("listView"),n=this;e.resetUnreadMessagesCounter(function(e){e||n._updateBadge(0)}),t.scrollToBottom(),t.setTextFieldFocus(),this._hideBadge(),this._startTimer(),this._dimBadge()},onPanelDidDisappear:function(){this._brightBadge(),this._pauseTimer()},onPanelDidUnload:function(){var e=this.get("model");e.closeConversation()},updateModel:function(e){var t=this.get("model"),n,r,i=this.get("notification"),s=this.get("listView"),o=this;t.get("etag")!==e.get("etag")&&(n=t.get("unreadMessagesCount"),t.load(function(e,u){e||(r=u.get("unreadMessagesCount"),r>n&&(s.get("hasMessageTextFieldFocus")?t.resetUnreadMessagesCounter():(i.notify(t.get("lastMessage")),o._updateBadge(r))),o._onConversationUpdated())}))},_attachEvents:function(){var t=this.get("listView"),n=this.get("model"),r=this.get("conversationCreateErrorView"),i=this.get("conversationReadErrorView");t.on("messageSubmitted",this._onMessageSubmitted,this),t.on("messageTextFieldFocus",this._onMessageTextFieldFocus,this),n.on("createBegin",this._onConversationCreateBegin,this),n.on("createSuccess",this._onConversationCreateSuccess,this),n.on("createError",this._onConversationCreateError,this),n.on("readSuccess",this._onConversationReadSuccess,this),n.on("readError",this._onConversationReadError,this),r.on("resendButtonClick",this._onConversationCreateRetry,this),i.on("resendButtonClick",this._onConversationReadRetry,this),e.on("connectionError",this._onConnectionError,this),e.on("connectionOK",this._onConnectionOK,this)},_startTimer:function(){var e=this.get("properties"),t=this.get("listView"),n=this.get("timerInterval");e.isChatEnabled()&&(t.updateTimestamps(),this.set("timer",setInterval(function(){t.updateTimestamps()},n)))},_pauseTimer:function(){var e=this.get("timer");clearTimeout(e)},_onConversationCreateBegin:function(){var e=this.get("listView");e.hideView()},_onConversationCreateSuccess:function(){var e=this.get("model");e.load()},_onConversationCreateError:function(){var e=this.get("conversationCreateErrorView");e.showErrorMessage(!0),this._hideActivityIndicator()},_onConversationCreateRetry:function(){var e=this.get("model");e.save()},_onConversationReadSuccess:function(){var e=this.get("conversationCreateErrorView"),t=this.get("conversationReadErrorView"),n=this.get("listView");e.hideErrorMessage(!1),t.hideErrorMessage(!1),n.showView()},_onConversationReadError:function(){var e=this.get("conversationCreateErrorView"),t=this.get("conversationReadErrorView"),n=this.get("listView");this._hideActivityIndicator(),e.hideErrorMessage(!0),t.showErrorMessage(!0),n.hideView()},_onConversationReadRetry:function(){var e=
this.get("model");e.load()},_onConversationUpdated:function(){var e=this.get("listView");e.showView()},_onMessageSubmitted:function(t){var n=this.get("model"),r=t.message,i=this.get("properties").getServerTimeOffset(),s=(new Date).getTime(),o,u=this.get("buddyDetails");o=s-i,n.addMessage(new e.LIMS.Model.MessageItemModel({from:u,body:r,createdAt:o}))},_onMessageTextFieldFocus:function(){var e=this.get("model"),t=this;e.get("unreadMessagesCount")>0&&e.resetUnreadMessagesCounter(function(e){e||t._updateBadge(0)})},_onConnectionError:function(){this.showError(e.LIMS.Core.i18n.values.connectionErrorMessage)},_onConnectionOK:function(){this.hideError()},_updateBadge:function(e){var t=this.get("badge");e===0?this._hideBadge():this._showBadge(),t&&t.set("innerHTML",e)},_showBadge:function(){var t=this.get("badge");t&&e.LIMS.Core.Util.show(t)},_hideBadge:function(){var t=this.get("badge");t&&e.LIMS.Core.Util.hide(t)},_brightBadge:function(){var e=this.get("badge");e.removeClass("dimmed")},_dimBadge:function(){var e=this.get("badge");e.addClass("dimmed")},_showActivityIndicator:function(){var t=this.get("activityIndicator");e.LIMS.Core.Util.show(t)},_hideActivityIndicator:function(){var t=this.get("activityIndicator");e.LIMS.Core.Util.hide(t)}},{ATTRS:{controllerId:{value:null},container:{value:null},model:{value:null},badge:{valueFn:function(){var e=this.get("container");return e.one(".unread")}},listView:{valueFn:function(){var t=this.get("container"),n=this.get("model");return new e.LIMS.View.ConversationListView({container:t.one(".panel-window"),model:n})}},panelContent:{valueFn:function(){return this.get("container").one(".panel-content")}},activityIndicator:{valueFn:function(){return this.get("container").one(".preloader")}},conversationCreateErrorView:{valueFn:function(){var t=this.get("panelContent");return new e.LIMS.View.ErrorNotificationView({container:t,errorMessage:e.LIMS.Core.i18n.values.conversationCreateErrorMessage})}},conversationReadErrorView:{valueFn:function(){var t=this.get("panelContent");return new e.LIMS.View.ErrorNotificationView({container:t,errorMessage:e.LIMS.Core.i18n.values.conversationReadErrorMessage})}},timer:{value:null},timerInterval:{value:6e4},notification:{value:null},buddyDetails:{value:null},properties:{value:null},settings:{value:null}}})},"@VERSION@",{requires:["view","node"]}),YUI.add("lims-plugin",function(e,t){function n(){n.superclass.constructor.apply(this,arguments)}if(!e.one("#lims-container .lims-bar"))return;e.extend(n,e.Plugin.Base,{CLASS_NAME:"token-input-plugin",KEY_BACKSPACE:8,KEY_DELETE:46,KEY_DOWN:40,KEY_ENTER:13,KEY_LEFT:37,KEY_RIGHT:39,KEY_UP:38,DELIMITER:"delimiter",TOKENS:"tokens",VALUE:"value",EMPTY_OBJECT:{},BOX_TEMPLATE:"<div/>",CONTENT_TEMPLATE:"<div/>",INPUT_TEMPLATE:'<input type="text" autocomplete="off">',ITEM_TEMPLATE:"<li/>",LIST_TEMPLATE:"<ul/>",REMOVE_TEMPLATE:'<a href="#"><span role="img">\u00d7</span></a>',initializer:function(){var t={},r={},i;e.Object.each(n.CLASS_NAMES,function(e,t){r[t]="."+e},this),t[this.KEY_BACKSPACE]=this._keyBackspace,t[this.KEY_DELETE]=this._keyDelete,t[this.KEY_DOWN]=this._keyDown,t[this.KEY_ENTER]=this._keyEnter,t[this.KEY_LEFT]=this._keyLeft,t[this.KEY_RIGHT]=this._keyRight,t[this.KEY_UP]=this._keyUp,this._host=this.get("host"),this._keys=t,this._selectors=r,i=this._tokenizeValue(this._host,null,{all:!0,updateUI:!1}),i&&this.set(this.TOKENS,this.get(this.TOKENS).concat(i)),this._render(),this._bind(),this._sync()},destructor:function(){var e=this._events;while(e&&e.length)e.pop().detach()},add:function(t,n){var r=[],i=[],s=this.get(this.TOKENS);return t=e.Lang.isArray(t)?t:t.split(this.get(this.DELIMITER)),e.Array.each(t,function(t){t=e.Lang.trim(t);if(t){r.push(t);var n=this._createItem({text:t,token:!0});i.push(n),this.fire("addToken",{token:t,node:n})}},this),i.length&&r.length&&(i=e.all(i).toFrag(),(n||n===0)&&n<s.length?(s=s.concat(),s.splice.apply(s,[n,0].concat(r)),this._tokenNodes.item(n).insert(i,"before")):(s=s.concat(r),this._inputItem.insert(i,"before")),this._tokenNodes.refresh(),this.set(this.TOKENS,s,{atomic:!0})),this},clear:function(){return this._tokenNodes.remove(!0),this._tokenNodes.refresh(),this.set(this.TOKENS,[],{atomic:!0})},remove:function(e){var t=this.get(this.TOKENS).concat(),n=t[e];return t.splice(e,1),this._tokenNodes.item(e).remove(!0),this._tokenNodes.refresh(),this.fire("removeToken",{token:n,tokenIndex:e}),this.set(this.TOKENS,t,{atomic:!0})},_bind:function(){var t=this._list,n=this._selectors;this._events||(this._events=[]),this._events.concat([this._boundingBox.after({blur:this._afterBlur,focus:this._afterFocus},null,this),t.delegate({blur:this._onTokenBlur,focus:this._onTokenFocus,mouseover:this._onTokenMouseOver,mouseout:this._onTokenMouseOut},n.token,this),t.delegate(e.UA.gecko?"keypress":"keydown",this._onKey,n.input+","+n.token,this),t.delegate("click",this._onRemoveClick,n.remove,this),this.after({fauxInputChange:this._afterFauxInputChange,removeButtonChange:this._afterRemoveButtonChange,tokensChange:this._afterTokensChange})])},_clearItems:function(){this._list.all(this._selectors.item).remove(!0)},_createItem:function(t){var r=n.CLASS_NAMES,i=e.Node.create(this.ITEM_TEMPLATE),s;return t||(t=this.EMPTY_OBJECT),i.addClass(r.item),e.Array.each(["editable","hidden","token"],function(e){t[e]&&i.addClass(r[e])}),t.editable&&(s=e.Node.create(this.INPUT_TEMPLATE).addClass(r.input),s.on("valueChange",this._afterInputValueChange,this),i.append(s)),t.token&&(i.setAttrs({tabIndex:0,text:t.text||""}),this.get("removeButton")&&i.addClass(r.hasremove).append(e.Node.create(this.REMOVE_TEMPLATE).addClass(r.remove).set("role","button"))),i},_focusNext:function(e){var t=this._selectors,n;return e=e.ancestor(t.item,!0),n=e&&e.next(t.token),n?n.focus():this._inputNode.focus(),!0},_focusPrev:function(e){var t=this._selectors,n;return e=e.ancestor(t.item,!0),n=e&&e.previous(t.token),n?(n.focus(),!0):!1},_getSelection:function(t){var n=e.Node.getDOMNode(t),r={end:0,start:0}
,i,s,o;return"selectionStart"in n?(r.start=n.selectionStart,r.end=n.selectionEnd):n.createTextRange&&(s=n.value,i=s.length,o=e.config.doc.selection.createRange().duplicate(),o.moveEnd("character",i),r.start=o.text===""?i:s.lastIndexOf(o.text),o.moveStart("character",-i),r.end=o.text.length),r},_keyBackspace:function(e){var t=e.currentTarget,r,i,s;return t.hasClass(n.CLASS_NAMES.input)?(i=this._getSelection(t),i.start!==0||i.end!==0?!1:this._focusPrev(t)):(t=t.ancestor(this._selectors.token,!0),r=this._tokenNodes.indexOf(t),!t||r===-1?!1:(s=this._focusPrev(t)||this._focusNext(t),this.remove(r),s=!0,s))},_keyDelete:function(e){var t=e.currentTarget,r;return t.hasClass(n.CLASS_NAMES.token)?(r=this._tokenNodes.indexOf(t),r===-1?!1:(this._focusNext(t),this.remove(r),!0)):!1},_keyDown:function(e){return this._keyRight(e)},_keyEnter:function(){var t=e.Lang.trim(this._inputNode.get(this.VALUE));if(!this.get("tokenizeOnEnter")||!t)return!1;this._tokenizeValue(null,null,{all:!0})},_keyLeft:function(e){var t=e.currentTarget;return t.hasClass(n.CLASS_NAMES.input)&&this._getSelection(t).start!==0?!1:this._focusPrev(t)},_keyRight:function(e){var t=e.currentTarget;return t.hasClass(n.CLASS_NAMES.input)?!1:this._focusNext(t)},_keyUp:function(e){return this._keyLeft(e)},_refresh:function(){this._tokenNodes?this._tokenNodes.refresh():this._tokenNodes=this._list.all(this._selectors.token)},_render:function(){var t=this._host,r=n.CLASS_NAMES,i=e.Node.create(this.BOX_TEMPLATE),s=e.Node.create(this.CONTENT_TEMPLATE),o=t.get("className"),u=t.get("id");s.addClass(r.content),i.addClass(r.box).addClass(r.os).set("tabIndex",-1).append(s),this._set("boundingBox",i),this._set("contentBox",s),this._boundingBox=i,this._contentBox=s,this._renderList(),u&&i.set("id",u+"-token-input-plugin"),o&&i.addClass(o),t.addClass(r.host).addClass(r.hidden).insert(i,"after")},_renderList:function(){var t=e.Node.create(this.LIST_TEMPLATE);t.addClass(n.CLASS_NAMES.list),this._list=t,this._set("listNode",t),this._contentBox.append(t)},_setTokens:function(t){return e.Array.filter(t,function(t){return!!e.Lang.trim(t)})},_sync:function(){var t=[],r=this.get(this.TOKENS);this._contentBox[this.get("fauxInput")?"addClass":"removeClass"](n.CLASS_NAMES.fauxinput),e.Array.each(r,function(n){t.push(this._createItem({text:e.Lang.trim(n),token:!0}))},this),this._inputItem=this._createItem({editable:!0}),this._inputNode=this._inputItem.one(this._selectors.input),this._set("inputNode",this._inputNode),t.push(this._inputItem),t=e.all(t).toFrag(),this._clearItems(),this._list.append(t),this._refresh(),this._syncHost()},_syncHost:function(){this._host.set(this.VALUE,this.get(this.TOKENS).join(this.get(this.DELIMITER)))},_tokenizeValue:function(t,n,r){var i;r=e.merge({updateUI:!0},r||this.EMPTY_OBJECT),t||(t=this._inputNode),!n&&n!==""&&(n=t.get(this.VALUE)),i=n.split(this.get(this.DELIMITER));if(r.all||i.length>1)r.all?n="":n=e.Lang.trim(i.pop()),r.updateUI&&(t.set(this.VALUE,n),i.length&&this.add(i));return r.updateUI&&t.setStyle("width",Math.max(5,n.length+3)+"ex"),i},_afterBlur:function(){var e=this;this.get("tokenizeOnBlur")&&setTimeout(function(){e._tokenizeValue(null,null,{all:!0})},100)},_afterFauxInputChange:function(){this._sync()},_afterFocus:function(e){var t=this;e.target.ancestor(this._selectors.item,!0)||setTimeout(function(){t._inputNode.focus()},1)},_afterInputValueChange:function(e){this._tokenizeValue(e.currentTarget,e.newVal)},_afterRemoveButtonChange:function(){this._sync()},_afterTokensChange:function(e){e.atomic?this._syncHost():this._sync()},_onKey:function(e){var t=this._keys[e.keyCode];t&&t.call(this,e)!==!1&&e.preventDefault()},_onRemoveClick:function(e){var t=e.currentTarget.ancestor(this._selectors.item);e.preventDefault(),this.remove(this._tokenNodes.indexOf(t))},_onTokenBlur:function(e){e.currentTarget.removeClass(n.CLASS_NAMES.focus)},_onTokenFocus:function(e){e.currentTarget.addClass(n.CLASS_NAMES.focus)},_onTokenMouseOut:function(e){e.currentTarget.removeClass(n.CLASS_NAMES.hover)},_onTokenMouseOver:function(e){e.currentTarget.addClass(n.CLASS_NAMES.hover)}},{NAME:"pluginTokenInputPlugin",NS:"tokenInputPlugin",ATTRS:{boundingBox:{readOnly:!0},contentBox:{readOnly:!0},delimiter:{value:","},fauxInput:{value:!1},inputNode:{readOnly:!0},listNode:{readOnly:!0},removeButton:{value:!!e.UA.mobile},tokenizeOnBlur:{value:!0},tokenizeOnEnter:{value:!0},tokens:{setter:"_setTokens",value:[]}},CLASS_NAMES:{box:"token-input-plugin",content:"token-input-plugin-content",editable:"token-input-plugin-editable",fauxinput:"token-input-plugin-fauxinput",focus:"token-input-plugin-focus",hasremove:"token-input-plugin-hasremove",hidden:"token-input-plugin-hidden",host:"token-input-plugin-host",hover:"token-input-plugin-hover",input:"token-input-plugin-input",item:"token-input-plugin-item",list:"token-input-plugin-list",os:"token-input-plugin-"+e.UA.os,remove:"token-input-plugin-remove",token:"token-input-plugin-token"}}),e.Plugin.TokenInputPlugin=n},"@VERSION@",{requires:["array-extras","classnamemanager","event-focus","event-valuechange","node-event-delegate","node-pluginhost","node-style","plugin"]}),YUI.add("lims",function(e,t){},"@VERSION@");
